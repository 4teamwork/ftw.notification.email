Composer
========
>>> from ftw.notification.email.composer import HTMLComposer
>>> from ftw.notification.email.composer import create_html_mail
>>> from ftw.notification.email.interfaces import IEMailRepresentation, ISubjectCreator
>>> from zope.app.component.hooks import getSite
>>> from Products.CMFCore.utils import getToolByName
>>> from plone.app.testing import TEST_USER_NAME
>>> from plone.app.testing import TEST_USER_ID
>>> from plone.app.testing import setRoles
>>> from plone.app.testing import login



Globals:
	>>> app = layer.get('app')
    >>> portal = layer.get('portal')
    >>> request = layer.get('request')

create the message object:

>>> login(portal, TEST_USER_NAME)
>>> setRoles(portal, TEST_USER_ID, ['Member', 'Contributor', 'Manager'])
>>> portal.invokeFactory('File', 'testdoc')
'testdoc'
>>> obj = portal['testdoc']
>>> subject = ISubjectCreator(obj)(obj)

>>> email = IEMailRepresentation(obj)('Subject',
...                                   [(u'H\xfcgo B\xf6ss','h.boss@testing.ch')],
...                                   [('Testi Testmann','testi@testing.ch')],
...                                   'Message Body', **{'sender':('test','test@localhost')})
>>> email
<email.mime.multipart.MIMEMultipart instance ...>
>>> content=email.get_payload()[0]
>>> conseption=content.get_payload()
>>> conseption[0].get_payload()
 '\ntest has sent you a notification comment\n\nMessage Body\n\n------------------------------------------------------------------------\n\nhttp://nohost/plone/testdoc[1]\n\n------------------------------------------------------------------------\n\nDieses Mail wurde automatisch generiert. Um eine Antwort an die\nAbsenderIn zu verfassen, benutzen Sie bitte die Angaben in der\nFusszeile.\n\n--\n\ntest - test@localhost\n\n------------------------------------------------------------------------\n\n[1] http://nohost/plone/testdoc\n'
>>> conseption[1].get_payload()
'<html xmlns=3D"http://www.w3.org/1999/xhtml" xml:lang=3D"en" lang=3D"en">\n<head>\n<title>Subject</title>\n\n</head>\n<body style=3D"font-family: Arial !important; font-size: 10pt !important">\n<div id=3D"message" style=3D"width: auto">\n<p style=3D"width: auto">test has sent you a notification</p>\n<strong>comment</strong><br />\n<p style=3D"width: auto">Message Body</p>\n<hr style=3D"border: none;" />\n<h2 style=3D"border: none; font-family: Arial !important"></h2>\n<p style=3D"width: auto"></p>\n<p style=3D"width: auto"><a href=3D"http://nohost/plone/testdoc" style=3D"c=\nolor: Black !important; padding: 0 !important; text-decoration: underline !=\nimportant">http://nohost/plone/testdoc</a></p>\n<hr style=3D"border: none;" />\n<p style=3D"width: auto">Dieses Mail wurde automatisch generiert. Um eine A=\nntwort an die AbsenderIn zu verfassen, benutzen Sie bitte die Angaben in de=\nr Fusszeile. </p>\n<p style=3D"width: auto">--</p>\n<p style=3D"width: auto">test - test@localhost</p>\n</div>\n</body>\n</html>'

>>> email.items()
[('Content-Type', 'multipart/mixed'), ('MIME-Version', '1.0'), ('Subject', <email.header.Header instance at ...>), ('From', ''), ('To', '=?utf-8?q?H=C3=BCgo_B=C3=B6ss?= <h.boss@testing.ch>'), ('Date', '...'), ('Message-ID', '<...>'), ('CC', 'Testi Testmann <testi@testing.ch>'), ('Reply-To', 'test <test@localhost>')]
>>> mailhost = getToolByName(obj, "MailHost")
>>> mailhost
<MailHost at /plone/MailHost>
>>> mailhost.smtp_host
''
>>> mailhost.send(email.as_string(), 'v.baumann@4teamwork.ch', 'test@localhost', 'Subject')

